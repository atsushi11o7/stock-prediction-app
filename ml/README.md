# æ ªä¾¡äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ 

TOPIX Core30éŠ˜æŸ„ã‚’å¯¾è±¡ã¨ã—ãŸã€LSTMæ·±å±¤å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹12ãƒ¶æœˆå…ˆæ ªä¾¡äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ 

---

## ğŸ“‹ ç›®æ¬¡

- [æ¦‚è¦](#æ¦‚è¦)
- [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ](#ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ)
- [ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ](#ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ)
- [é‹ç”¨ã‚¬ã‚¤ãƒ‰](#é‹ç”¨ã‚¬ã‚¤ãƒ‰)
  - [æ—¥æ¬¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³](#æ—¥æ¬¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³)
  - [æœˆæ¬¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³](#æœˆæ¬¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³)
- [é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰](#é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰)
  - [åˆå›å­¦ç¿’](#åˆå›å­¦ç¿’)
  - [æ¨è«–](#æ¨è«–)
  - [ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°](#ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°)
- [AWS Lambda ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ](#aws-lambda-ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ)
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
- [é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](#é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)

---

## æ¦‚è¦

### ã‚·ã‚¹ãƒ†ãƒ ã®ç‰¹å¾´

- **ãƒ‡ãƒ¼ã‚¿å–å¾—**: yfinance APIçµŒç”±ã§æ—¥æ¬¡ãƒ»éå»ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
- **ç‰¹å¾´é‡**: é€±æ¬¡23ç‰¹å¾´ Ã— 156é€± + é™çš„6ç‰¹å¾´ + ãƒã‚¸ã‚·ãƒ§ãƒ³2ç‰¹å¾´
- **ãƒ¢ãƒ‡ãƒ«**: BiLSTM + ã‚»ã‚¯ã‚¿ãƒ¼Embedding + MLPï¼ˆç´„664K ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
- **å­¦ç¿’**: PyTorch Lightningã€ONNX ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- **æ¨è«–**: ONNX Runtimeï¼ˆCPUå°‚ç”¨ã€Lambdaå¯¾å¿œï¼‰
- **å‡ºåŠ›**: 1~12ãƒ¶æœˆå…ˆã®æœˆæ¬¡æ ªä¾¡äºˆæ¸¬
- **é‹ç”¨**: æ—¥æ¬¡æ¨è«– + æœˆæ¬¡ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

| é …ç›® | å€¤ |
|-----|---|
| å­¦ç¿’ã‚µãƒ³ãƒ—ãƒ«æ•° | ç´„40,000 |
| å­¦ç¿’æ™‚é–“ï¼ˆGPUï¼‰ | ç´„20-30åˆ† |
| æ¨è«–æ™‚é–“ï¼ˆ31éŠ˜æŸ„ï¼‰ | ç´„3-5ç§’ |
| ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°æ™‚é–“ï¼ˆCPUï¼‰ | ç´„5-7åˆ† |
| ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚ºï¼ˆONNXï¼‰ | ç´„2.5MB |

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
ml/
â”œâ”€â”€ config/                    # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ train.yaml             # å­¦ç¿’è¨­å®š
â”‚   â”œâ”€â”€ predict.yaml           # æ¨è«–è¨­å®š
â”‚   â”œâ”€â”€ finetune.yaml          # ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°è¨­å®š
â”‚   â”œâ”€â”€ enrich_universe.yaml   # é™çš„ç‰¹å¾´é‡æ›´æ–°è¨­å®š
â”‚   â”œâ”€â”€ fetch_daily_universe.yaml   # æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿å–å¾—è¨­å®š
â”‚   â”œâ”€â”€ fetch_daily_backfill.yaml   # ãƒãƒƒã‚¯ãƒ•ã‚£ãƒ«è¨­å®š
â”‚   â”œâ”€â”€ sectors.yaml           # ã‚»ã‚¯ã‚¿ãƒ¼å®šç¾©ï¼ˆå…±é€šï¼‰
â”‚   â””â”€â”€ universes/             # Universeå®šç¾©
â”‚       â””â”€â”€ enrich_*.yaml      # é™çš„ç‰¹å¾´é‡ä»˜ãUniverse
â”œâ”€â”€ src/                       # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ common/                # å…±é€šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ constants.py       # å®šæ•°å®šç¾©ï¼ˆãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼é›†ç´„ï¼‰
â”‚   â”‚   â”œâ”€â”€ logging_config.py  # ãƒ­ã‚®ãƒ³ã‚°è¨­å®š
â”‚   â”‚   â””â”€â”€ s3_operations.py   # S3æ“ä½œ
â”‚   â”œâ”€â”€ data/                  # ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”‚   â”œâ”€â”€ utils/             # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py      # è¨­å®šèª­ã¿è¾¼ã¿ï¼ˆå…±é€šï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ io.py          # ãƒ‡ãƒ¼ã‚¿I/Oï¼ˆãƒ­ãƒ¼ã‚«ãƒ«/S3ä¸¡å¯¾å¿œï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ universe_loader.py  # Universeèª­ã¿è¾¼ã¿
â”‚   â”‚   â”‚   â””â”€â”€ yfin.py        # yfinanceæ“ä½œ
â”‚   â”‚   â”œâ”€â”€ fetch_daily_universe.py   # æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿å–å¾—
â”‚   â”‚   â””â”€â”€ fetch_daily_backfill.py   # ãƒãƒƒã‚¯ãƒ•ã‚£ãƒ«
â”‚   â”œâ”€â”€ features/              # ç‰¹å¾´é‡è¨ˆç®—
â”‚   â”‚   â”œâ”€â”€ enrich_universe.py # é™çš„ç‰¹å¾´é‡ä»˜ä¸
â”‚   â”‚   â”œâ”€â”€ weekly_features.py # é€±æ¬¡ç‰¹å¾´é‡
â”‚   â”‚   â”œâ”€â”€ valuation_features.py  # ãƒãƒªãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ç‰¹å¾´é‡
â”‚   â”‚   â””â”€â”€ position_features.py   # ãƒã‚¸ã‚·ãƒ§ãƒ³ç‰¹å¾´é‡
â”‚   â”œâ”€â”€ inference/             # æ¨è«–ã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â”‚   â””â”€â”€ predict.py         # ONNXæ¨è«–
â”‚   â”œâ”€â”€ model_src/             # ãƒ¢ãƒ‡ãƒ«å®šç¾©
â”‚   â”‚   â”œâ”€â”€ models/            # LSTMãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â”œâ”€â”€ lit_modules/       # PyTorch Lightningãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â””â”€â”€ datamodules/       # DataModule
â”‚   â”œâ”€â”€ pipeline/              # ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
â”‚   â”‚   â”œâ”€â”€ daily_pipeline.py  # æ—¥æ¬¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
â”‚   â”‚   â””â”€â”€ monthly_pipeline.py    # æœˆæ¬¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
â”‚   â””â”€â”€ training/              # å­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚       â”œâ”€â”€ train.py           # åˆå›å­¦ç¿’
â”‚       â”œâ”€â”€ finetune.py        # ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
â”‚       â””â”€â”€ utils/             # å­¦ç¿’ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚           â””â”€â”€ onnx_export.py # ONNXã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”œâ”€â”€ data/                      # ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â”œâ”€â”€ training/daily/        # å­¦ç¿’ç”¨æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿
â”‚   â””â”€â”€ serving/daily/         # æ¨è«–ç”¨æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ docs/                      # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ checkpoints/               # å­¦ç¿’ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ models/onnx/               # ONNXãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ logs/                      # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ README.md                  # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

---

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# 1. é™çš„ç‰¹å¾´é‡ã®ä»˜ä¸
python src/features/enrich_universe.py --config config/enrich_universe.yaml

# 2. éå»ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆ5å¹´åˆ†ï¼‰
python src/data/fetch_daily_backfill.py --config config/fetch_daily_backfill.yaml

# 3. åˆå›å­¦ç¿’
python src/training/train.py --config config/train.yaml
```

### æ—¥æ¬¡é‹ç”¨ï¼ˆæ¯å–¶æ¥­æ—¥ï¼‰

```bash
# ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œï¼ˆãƒ‡ãƒ¼ã‚¿å–å¾— + æ¨è«–ï¼‰
python src/pipeline/daily_pipeline.py \
  --fetch-config config/fetch_daily_universe.yaml \
  --predict-config config/predict.yaml

# å˜ä½“ã§æ¨è«–ã®ã¿å®Ÿè¡Œ
python src/inference/predict.py --config config/predict.yaml

# å˜ä½“ã§ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ã¿å®Ÿè¡Œ
python src/data/fetch_daily_universe.py --config config/fetch_daily_universe.yaml
```

### æœˆæ¬¡é‹ç”¨ï¼ˆæ¯æœˆ1æ—¥ï¼‰

```bash
# ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œï¼ˆç‰¹å¾´é‡æ›´æ–° + ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ï¼‰
python src/pipeline/monthly_pipeline.py \
  --enrich-config config/enrich_universe.yaml \
  --finetune-config config/finetune.yaml
```

---

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

### é‹ç”¨ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—                        â”‚
â”‚  1. Universe YAMLä½œæˆ                                   â”‚
â”‚  2. é™çš„ç‰¹å¾´é‡ä»˜ä¸ (enrich_universe.py)                  â”‚
â”‚  3. éå»ãƒ‡ãƒ¼ã‚¿å–å¾— (fetch_daily_backfill.py)             â”‚
â”‚  4. åˆå›å­¦ç¿’ (train.py)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ—¥æ¬¡é‹ç”¨ï¼ˆæ¯å–¶æ¥­æ—¥ JST 23:00ï¼‰                â”‚
â”‚  1. æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿å–å¾— (fetch_daily_universe.py)             â”‚
â”‚  2. æ¨è«–å®Ÿè¡Œ (predict.py)                                â”‚
â”‚  3. çµæœS3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æœˆæ¬¡é‹ç”¨ï¼ˆæ¯æœˆ1æ—¥ JST 00:00ï¼‰                 â”‚
â”‚  1. é™çš„ç‰¹å¾´é‡æ›´æ–° (enrich_universe.py)                  â”‚
â”‚  2. ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚° (finetune.py)                    â”‚
â”‚  3. æ–°ãƒ¢ãƒ‡ãƒ«S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ¢ãƒ‡ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
å…¥åŠ›:
  - weekly_seq: (156é€±, 23ç‰¹å¾´)
  - static_features: (6ç‰¹å¾´) â† PER, PBR, é…å½“åˆ©å›ã‚Šç­‰
  - position_features: (2ç‰¹å¾´) â† day_of_week, week_progress
  - sector_id: (1)

ãƒ¢ãƒ‡ãƒ«:
  SectorEmbedding â†’ BiLSTM â†’ MLP â†’ å‡ºåŠ›

å‡ºåŠ›:
  - 1~12ãƒ¶æœˆå…ˆå¯¾æ•°ãƒªã‚¿ãƒ¼ãƒ³ (12å€¤)
  - å„æœˆã®äºˆæ¸¬æ ªä¾¡ã«å¤‰æ›ã—ã¦å‡ºåŠ›
```

---

## é‹ç”¨ã‚¬ã‚¤ãƒ‰

### æ—¥æ¬¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

æ¯å–¶æ¥­æ—¥å®Ÿè¡Œã™ã‚‹å‡¦ç†ã§ã™ã€‚æœ€æ–°ã®å¸‚å ´ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€12ãƒ¶æœˆå…ˆã®æ ªä¾¡ã‚’äºˆæ¸¬ã—ã¾ã™ã€‚

#### å®Ÿè¡Œæ–¹æ³•

```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã§å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
python src/pipeline/daily_pipeline.py \
  --fetch-config config/fetch_daily_universe.yaml \
  --predict-config config/predict.yaml

# ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆæ¨è«–ã®ã¿ï¼‰
python src/pipeline/daily_pipeline.py \
  --predict-config config/predict.yaml \
  --skip-fetch

# S3ç’°å¢ƒã§å®Ÿè¡Œï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§env: "s3"ã‚’æŒ‡å®šï¼‰
python src/pipeline/daily_pipeline.py \
  --fetch-config config/fetch_daily_universe.yaml \
  --predict-config config/predict.yaml
```

#### å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
[Step 1: æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿å–å¾—]
  - yfinance APIã‹ã‚‰æœ€æ–°ã®OHLCVãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  - JSONå½¢å¼ã§ä¿å­˜
  â†“
[Step 2: æ¨è«–å®Ÿè¡Œ]
  - ONNXãƒ¢ãƒ‡ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰
  - å„éŠ˜æŸ„ã«ã¤ã„ã¦:
    - é€±æ¬¡ç‰¹å¾´é‡ã‚’è¨ˆç®— (156é€± Ã— 23ç‰¹å¾´)
    - é™çš„ç‰¹å¾´é‡ã‚’è¨ˆç®— (6ç‰¹å¾´)
    - ãƒã‚¸ã‚·ãƒ§ãƒ³ç‰¹å¾´é‡ã‚’è¨ˆç®— (2ç‰¹å¾´)
    - 12ãƒ¶æœˆå…ˆã®ãƒªã‚¿ãƒ¼ãƒ³ã‚’äºˆæ¸¬
  - çµæœã‚’JSONå½¢å¼ã§ä¿å­˜
```

#### å‡ºåŠ›ä¾‹

```json
{
  "timestamp": "2025-12-20T23:00:00",
  "num_predictions": 31,
  "predictions": [
    {
      "ticker": "2914.T",
      "as_of_date": "2025-12-20",
      "current_price": 4250.5,
      "predictions": [
        {"month": 1, "predicted_price": 4280.2, "return": 0.007},
        {"month": 2, "predicted_price": 4310.5, "return": 0.014},
        {"month": 3, "predicted_price": 4341.0, "return": 0.021},
        ...
        {"month": 12, "predicted_price": 4625.3, "return": 0.088}
      ],
      "predicted_12m_price": 4625.3,
      "predicted_12m_return": 0.088,
      "sector": "Consumer Defensive"
    }
  ]
}
```

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- **å‡¦ç†æ™‚é–“**: ç´„5-10åˆ†
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: ç´„200-300MB
- **Lambdaæ¨å¥¨è¨­å®š**: ãƒ¡ãƒ¢ãƒª512MBã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ600ç§’

### æœˆæ¬¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

æ¯æœˆ1æ—¥ã«å®Ÿè¡Œã™ã‚‹å‡¦ç†ã§ã™ã€‚é™çš„ç‰¹å¾´é‡ã‚’æ›´æ–°ã—ã€ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¾ã™ã€‚

#### å®Ÿè¡Œæ–¹æ³•

```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã§å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
python src/pipeline/monthly_pipeline.py \
  --enrich-config config/enrich_universe.yaml \
  --finetune-config config/finetune.yaml

# ç‰¹å¾´é‡æ›´æ–°ã‚’ã‚¹ã‚­ãƒƒãƒ—
python src/pipeline/monthly_pipeline.py \
  --finetune-config config/finetune.yaml \
  --skip-enrich

# S3ç’°å¢ƒã§å®Ÿè¡Œï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§env: "s3"ã‚’æŒ‡å®šï¼‰
python src/pipeline/monthly_pipeline.py \
  --enrich-config config/enrich_universe.yaml \
  --finetune-config config/finetune.yaml
```

#### å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
[Step 1: é™çš„ç‰¹å¾´é‡æ›´æ–°]
  - yfinance APIã‹ã‚‰æœ€æ–°ã®é™çš„æƒ…å ±ã‚’å–å¾—
    - PER (æ ªä¾¡åç›Šç‡)
    - PBR (æ ªä¾¡ç´”è³‡ç”£å€ç‡)
    - DividendYield (é…å½“åˆ©å›ã‚Š)
  â†“
[Step 2: ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°]
  - ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°:
    - ç›´è¿‘1ãƒ¶æœˆ: ç´„690ã‚µãƒ³ãƒ—ãƒ« (67%)
    - éå»ãƒ‡ãƒ¼ã‚¿: ç´„345ã‚µãƒ³ãƒ—ãƒ« (33%, ãƒ©ãƒ³ãƒ€ãƒ )
  - ãƒ¢ãƒ‡ãƒ«å†æ§‹ç¯‰
  - å°‘æ•°ã‚¨ãƒãƒƒã‚¯ã§å­¦ç¿’ (éå­¦ç¿’é˜²æ­¢)
  - ONNXå½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
```

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- **å‡¦ç†æ™‚é–“**: ç´„10-15åˆ†
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: ç´„1.5-2GB
- **Lambdaæ¨å¥¨è¨­å®š**: ãƒ¡ãƒ¢ãƒª2048-3008MBã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ900ç§’

---

## é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰

### åˆå›å­¦ç¿’

åˆå›ã®å­¦ç¿’ã§ã¯ã€éå»5å¹´åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦LSTMãƒ¢ãƒ‡ãƒ«ã‚’å­¦ç¿’ã—ã¾ã™ã€‚

#### ãƒ‡ãƒ¼ã‚¿æº–å‚™

```bash
# 1. é™çš„ç‰¹å¾´é‡ä»˜ä¸
python src/features/enrich_universe.py --config config/enrich_universe.yaml

# 2. éå»ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆ5å¹´åˆ†ï¼‰
python src/data/fetch_daily_backfill.py --config config/fetch_daily_backfill.yaml
```

#### å­¦ç¿’å®Ÿè¡Œ

```bash
# åŸºæœ¬å®Ÿè¡Œ
python src/training/train.py --config config/train.yaml
```

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°ã¯ [config/README.md](config/README.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

```
checkpoints/
  â””â”€â”€ best_model.ckpt           # ãƒ™ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ï¼ˆå›ºå®šåã€ä¸Šæ›¸ãæ›´æ–°ï¼‰

models/onnx/
  â”œâ”€â”€ best_model.onnx           # ONNXãƒ¢ãƒ‡ãƒ«ï¼ˆå›ºå®šåï¼‰
  â””â”€â”€ best_model.json           # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚»ã‚¯ã‚¿ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°ç­‰ï¼‰
```

### æ¨è«–

å­¦ç¿’æ¸ˆã¿ONNXãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€12ãƒ¶æœˆå…ˆã®æ ªä¾¡ã‚’äºˆæ¸¬ã—ã¾ã™ã€‚

#### å®Ÿè¡Œæ–¹æ³•

```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã§å®Ÿè¡Œ
python src/inference/predict.py --config config/predict.yaml
```

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°ã¯ [config/README.md](config/README.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### æ¨è«–ã®æµã‚Œ

1. Universe YAMLã‹ã‚‰éŠ˜æŸ„ãƒªã‚¹ãƒˆã¨é™çš„æƒ…å ±ã‚’å–å¾—
2. å„éŠ˜æŸ„ã®æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
3. é€±æ¬¡ç‰¹å¾´é‡ã‚’è¨ˆç®—ï¼ˆ156é€± Ã— 23ç‰¹å¾´ï¼‰
4. é™çš„ç‰¹å¾´é‡ã‚’è¨ˆç®—ï¼ˆ6ç‰¹å¾´ï¼‰
5. ãƒã‚¸ã‚·ãƒ§ãƒ³ç‰¹å¾´é‡ã‚’è¨ˆç®—ï¼ˆ2ç‰¹å¾´ï¼‰
6. ONNXæ¨è«–ã‚’å®Ÿè¡Œ
7. çµæœã‚’JSONå½¢å¼ã§ä¿å­˜

#### å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

```
predictions/
  â”œâ”€â”€ 2025-12-20.json    # æ—¥ä»˜åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå±¥æ­´ç”¨ï¼‰
  â”œâ”€â”€ 2025-12-19.json
  â”œâ”€â”€ ...
  â””â”€â”€ latest.json        # æœ€æ–°ã®äºˆæ¸¬çµæœï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIå‚ç…§ç”¨ï¼‰
```

#### äºˆæ¸¬çµæœã®åˆ©ç”¨ä¾‹

```python
import json

# æœ€æ–°ã®çµæœã‚’èª­ã¿è¾¼ã¿
with open("predictions/latest.json", "r") as f:
    results = json.load(f)

# ã¾ãŸã¯æ—¥ä»˜ã‚’æŒ‡å®šã—ã¦èª­ã¿è¾¼ã¿
# with open("predictions/2025-12-20.json", "r") as f:
#     results = json.load(f)

# ä¸Šä½5éŠ˜æŸ„ã‚’ãƒ©ãƒ³ã‚­ãƒ³ã‚°
sorted_preds = sorted(
    results["predictions"],
    key=lambda x: x["predicted_12m_return"],
    reverse=True
)

print("Top 5 Predicted Returns (12M):")
for i, pred in enumerate(sorted_preds[:5], 1):
    print(f"{i}. {pred['ticker']}: {pred['predicted_12m_return']:+.2%}")
```

### ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã‚’æœˆæ¬¡ã§ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¦ã€æœ€æ–°ã®ãƒˆãƒ¬ãƒ³ãƒ‰ã«é©å¿œã•ã›ã¾ã™ã€‚

#### ãªãœãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãŒå¿…è¦ã‹

1. **å¸‚å ´ç’°å¢ƒã®å¤‰åŒ–**: æ ªå¼å¸‚å ´ã¯å¸¸ã«å¤‰åŒ–ã—ã€æ–°ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå‡ºç¾
2. **ãƒ¢ãƒ‡ãƒ«ã®é®®åº¦ç¶­æŒ**: å¤ã„ãƒ‡ãƒ¼ã‚¿ã§å­¦ç¿’ã—ãŸãƒ¢ãƒ‡ãƒ«ã¯æœ€æ–°ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’æ‰ãˆã‚‰ã‚Œãªã„
3. **ç¶™ç¶šçš„æ”¹å–„**: æ¯æœˆæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§äºˆæ¸¬ç²¾åº¦ãŒå‘ä¸Š

#### å®Ÿè¡Œæ–¹æ³•

```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã§å®Ÿè¡Œ
python src/training/finetune.py --config config/finetune.yaml
```

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°ã¯ [config/README.md](config/README.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æˆ¦ç•¥

```
ç›´è¿‘1ãƒ¶æœˆ: ç´„1,200ã‚µãƒ³ãƒ—ãƒ« (67%)
éå»ãƒ‡ãƒ¼ã‚¿: ç´„600ã‚µãƒ³ãƒ—ãƒ« (33%, ãƒ©ãƒ³ãƒ€ãƒ )
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
åˆè¨ˆ:      ç´„1,800ã‚µãƒ³ãƒ—ãƒ«
```

éå»ãƒ‡ãƒ¼ã‚¿ã‚‚ãƒ©ãƒ³ãƒ€ãƒ ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ã§:
- éå­¦ç¿’ã‚’é˜²æ­¢
- é•·æœŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä¿æŒ
- æ–°ã—ã„ãƒˆãƒ¬ãƒ³ãƒ‰ã¨æ—¢å­˜çŸ¥è­˜ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹

---

## AWS Lambda ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### æ—¥æ¬¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ Lambdaè¨­å®š

#### é–¢æ•°è¨­å®š

```yaml
Function Name: stock-forecast-daily-pipeline
Runtime: Python 3.11
Memory: 512MB
Timeout: 600 seconds (10åˆ†)
Architecture: x86_64
```

#### ç’°å¢ƒå¤‰æ•°

```bash
CONFIG_PATH=/opt/config/predict.yaml
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ env: "s3" ã‚’æŒ‡å®š
```

#### Lambda ãƒãƒ³ãƒ‰ãƒ©ãƒ¼

```python
# lambda_handler.py
import sys
sys.path.insert(0, '/opt/ml/src')

from inference.predict import main

def lambda_handler(event, context):
    """AWS Lambda ãƒãƒ³ãƒ‰ãƒ©ãƒ¼"""
    # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ env: "s3" ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚Œã°è‡ªå‹•ã§S3ã‚’ä½¿ç”¨
    try:
        main()
        return {
            'statusCode': 200,
            'body': 'Daily pipeline completed successfully'
        }
    except Exception as e:
        return {
            'statusCode': 500,
            'body': f'Daily pipeline failed: {str(e)}'
        }
```

#### EventBridge ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

```yaml
# æ¯å–¶æ¥­æ—¥ JST 23:00 (UTC 14:00)
Schedule: cron(0 14 ? * MON-FRI *)
```

### æœˆæ¬¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ Lambdaè¨­å®š

#### é–¢æ•°è¨­å®š

```yaml
Function Name: stock-forecast-monthly-pipeline
Runtime: Python 3.11
Memory: 3008MB
Timeout: 900 seconds (15åˆ†)
Architecture: x86_64
```

#### ç’°å¢ƒå¤‰æ•°

```bash
CONFIG_PATH=/opt/config/finetune.yaml
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ env: "s3" ã‚’æŒ‡å®š
```

#### EventBridge ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

```yaml
# æ¯æœˆ1æ—¥ JST 00:00 (UTC 15:00, å‰æ—¥)
Schedule: cron(0 15 1 * ? *)
```

### Lambda Layerã®ä½œæˆ

#### ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

```bash
# requirements.txt
numpy==1.24.3
pandas==2.0.3
onnxruntime==1.16.0
pyyaml==6.0.1
yfinance==0.2.28
boto3==1.28.0
```

#### Layerãƒ“ãƒ«ãƒ‰

```bash
mkdir -p lambda-layer/python
pip install -r requirements.txt -t lambda-layer/python/
cd lambda-layer
zip -r lambda-layer.zip python/
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### æ—¥æ¬¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

#### ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—

**ç—‡çŠ¶**:
```
ERROR - Failed to fetch data for ticker: 2914.T
```

**åŸå› ã¨å¯¾å‡¦**:
1. yfinance API ãƒ¬ãƒ¼ãƒˆåˆ¶é™ â†’ å¾…æ©Ÿæ™‚é–“ã‚’å¢—ã‚„ã™
2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚¨ãƒ©ãƒ¼ â†’ ãƒªãƒˆãƒ©ã‚¤å›æ•°ã‚’å¢—ã‚„ã™
3. ãƒ†ã‚£ãƒƒã‚«ãƒ¼ã‚·ãƒ³ãƒœãƒ«ãŒç„¡åŠ¹ â†’ Universe YAMLã‚’ç¢ºèª

#### æ¨è«–å¤±æ•—ï¼ˆãƒ‡ãƒ¼ã‚¿ä¸è¶³ï¼‰

**ç—‡çŠ¶**:
```
ERROR - Insufficient data for 2914.T: only 100 weeks
```

**å¯¾å‡¦**:
```bash
# éå»ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆ156é€±åˆ†å¿…è¦ï¼‰
python src/data/fetch_daily_backfill.py \
  --universe-yaml config/universes/enrich_topix_core_30_20251031.yaml \
  --period 5y
```

#### ONNXãƒ¢ãƒ‡ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ç—‡çŠ¶**:
```
ERROR - ONNX model not found: models/onnx/best_model.onnx
```

**å¯¾å‡¦**:
```bash
# å­¦ç¿’ã‚’å®Ÿè¡Œã—ã¦ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆ
python src/training/train.py --config config/train.yaml
```

### æœˆæ¬¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

#### ãƒ¡ãƒ¢ãƒªä¸è¶³

**ç—‡çŠ¶**:
```
ERROR - Out of memory
```

**å¯¾å‡¦**:
- Lambda ãƒ¡ãƒ¢ãƒªè¨­å®šã‚’å¢—ã‚„ã™: 3008MB
- ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’æ¸›ã‚‰ã™: `--batch-size 16`
- `num_workers=0` ã‚’ç¢ºèªï¼ˆLambdaå¿…é ˆï¼‰

#### ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

**ç—‡çŠ¶**:
```
Task timed out after 900.00 seconds
```

**å¯¾å‡¦**:
- ã‚¨ãƒãƒƒã‚¯æ•°ã‚’æ¸›ã‚‰ã™: `--num-epochs 3`
- ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒ«æ•°ã‚’æ¸›ã‚‰ã™: `--recent-months 1`

### ä¸€èˆ¬çš„ãªå•é¡Œ

#### S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—

**ç—‡çŠ¶**:
```
ERROR - Error uploading to S3: Access Denied
```

**å¯¾å‡¦**:
1. IAMãƒ­ãƒ¼ãƒ«ã®æ¨©é™ç¢ºèªï¼ˆS3 PutObjectæ¨©é™ï¼‰
2. ãƒã‚±ãƒƒãƒˆåã‚’ç¢ºèª: `--s3-bucket`
3. AWSèªè¨¼æƒ…å ±ã‚’ç¢ºèª

#### CUDA out of memoryï¼ˆå­¦ç¿’æ™‚ï¼‰

**å¯¾å‡¦**:
```yaml
# config/train.yamlã‚’ç·¨é›†
data:
  batch_size: 16  # 32 â†’ 16

training:
  accumulate_grad_batches: 2  # å‹¾é…è“„ç©
```

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### è¨­å®šã‚¬ã‚¤ãƒ‰

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | ç›®çš„ |
|------------|------|
| [config/README.md](config/README.md) | è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ï¼ˆenvåˆ‡ã‚Šæ›¿ãˆã€å„è¨­å®šã®è©³ç´°ï¼‰ |

### é‹ç”¨ã‚¬ã‚¤ãƒ‰ï¼ˆé‹ç”¨æ‹…å½“è€…å‘ã‘ï¼‰

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | ç›®çš„ |
|------------|------|
| [OPERATIONS_REFERENCE.md](docs/OPERATIONS_REFERENCE.md) | é‹ç”¨ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ï¼ˆè©³ç´°ãªé‹ç”¨æ‰‹é †ï¼‰ |

### æŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆé–‹ç™ºè€…å‘ã‘ï¼‰

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | ç›®çš„ |
|------------|------|
| [stock_prediction_model_spec.md](docs/stock_prediction_model_spec.md) | ãƒ¢ãƒ‡ãƒ«ä»•æ§˜æ›¸ï¼ˆå…¥å‡ºåŠ›ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼‰ |
| [IMPLEMENTATION_SUMMARY.md](docs/IMPLEMENTATION_SUMMARY.md) | å®Ÿè£…ã‚µãƒãƒªãƒ¼ |
